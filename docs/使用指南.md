# 影藏·媒体管理器 - 完整使用指南

欢迎使用影藏·媒体管理器！本指南将帮助您充分利用这款强大的媒体管理工具。

## 目录

1. [快速开始](#快速开始)
   - [安装方式](#安装方式)
   - [首次启动](#首次启动)
   - [基本工作流](#基本工作流)
2. [界面介绍](#界面介绍)
   - [主窗口布局](#主窗口布局)
   - [菜单栏](#菜单栏)
   - [工具栏](#工具栏)
   - [侧边栏](#侧边栏)
   - [详情面板](#详情面板)
3. [核心功能](#核心功能)
   - [添加和管理媒体库](#添加和管理媒体库)
   - [扫描本地文件夹](#扫描本地文件夹)
   - [导入媒体文件](#导入媒体文件)
   - [编辑媒体信息](#编辑媒体信息)
   - [TMDB 自动匹配](#tmdb-自动匹配)
   - [搜索和筛选媒体](#搜索和筛选媒体)
   - [收藏和标记](#收藏和标记)
4. [高级功能](#高级功能)
   - [批量编辑](#批量编辑)
   - [导入/导出数据](#导入导出数据)
   - [海报管理](#海报管理)
   - [元数据编辑](#元数据编辑)
   - [媒体库设置](#媒体库设置)
5. [常见问题](#常见问题)
6. [故障排除](#故障排除)

---

## 快速开始

### 安装方式

影藏·媒体管理器提供多种安装方式，请选择最适合您的方式：

#### 方式一：下载 EXE（推荐 - Windows 用户）

1. 访问项目的 [Releases 页面](https://github.com/your-repo/media-manager/releases)
2. 下载最新版本的 `.exe` 安装程序
3. 双击运行安装程序
4. 按照向导完成安装
5. 从开始菜单或桌面快捷方式启动应用

**优点**：无需安装 Python，开箱即用，包含所有依赖项。

#### 方式二：pip 安装

如果您的系统已安装 Python 3.8 或更高版本：

```bash
# 从源码安装
git clone <repository-url>
cd media-manager

# 创建虚拟环境（推荐）
python -m venv venv

# Windows 激活虚拟环境
venv\Scripts\activate

# Linux/macOS 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install -e .
```

安装完成后，使用以下命令启动：

```bash
media-manager
```

#### 方式三：源码运行

适合开发者或需要自定义的用户：

```bash
# 克隆仓库
git clone <repository-url>
cd media-manager

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/macOS
# 或 venv\Scripts\activate  # Windows

# 安装开发依赖
pip install -e ".[dev]"

# 运行应用
python -m src.media_manager.main
```

### 首次启动

首次启动影藏·媒体管理器时，会显示**新手引导向导**，帮助您完成初始设置：

#### 第 1 步：欢迎页面

- 简要介绍应用程序的主要功能
- 说明设置流程
- 点击**下一步**继续

#### 第 2 步：API 密钥配置（可选但推荐）

配置 TMDB 或 TVDB API 密钥，以启用自动识别功能：

**获取 TMDB API 密钥：**
1. 注册账号：访问 [https://www.themoviedb.org/signup](https://www.themoviedb.org/signup)
2. 登录后进入 [设置 → API](https://www.themoviedb.org/settings/api)
3. 申请 API 密钥（选择"Developer"类型）
4. 复制 API 密钥（v3 auth）到应用中

**获取 TVDB API 密钥：**
1. 注册账号：访问 [https://thetvdb.com/](https://thetvdb.com/)
2. 登录后进入 [Dashboard → API Keys](https://thetvdb.com/dashboard/account/apikeys)
3. 创建新的 API 密钥
4. 复制密钥到应用中

> **提示**：如果暂时跳过此步骤，稍后可以在**编辑 → 首选项 → 提供商**中配置。

#### 第 3 步：创建第一个媒体库

- 输入媒体库名称（例如："我的电影"、"电视剧集"）
- 选择媒体类型（电影或电视剧）
- 浏览并选择存放媒体文件的文件夹
- 点击**完成**创建媒体库

#### 第 4 步：完成设置

- 新手引导完成
- 应用将自动开始扫描您指定的文件夹
- 扫描结果将显示在**匹配**标签页中

### 基本工作流

影藏·媒体管理器的典型使用流程如下：

```
添加媒体库 → 扫描文件夹 → 匹配元数据 → 查看和管理
```

**详细步骤：**

1. **添加媒体库**
   - 菜单：**文件 → 管理媒体库**
   - 指定媒体文件所在位置

2. **扫描文件夹**
   - 应用自动检测视频文件
   - 解析文件名提取信息

3. **匹配元数据**
   - 自动搜索 TMDB/TVDB 数据库
   - 在**匹配**标签页中确认结果
   - 点击**完成媒体库**保存

4. **查看和管理**
   - 浏览媒体库内容
   - 编辑元数据
   - 下载海报
   - 导出 NFO 文件

---

## 界面介绍

### 主窗口布局

影藏·媒体管理器采用经典的三栏式布局：

```
┌────────────────────────────────────────────────────┐
│  菜单栏：文件 | 编辑 | 查看 | 帮助                    │
├────────────────────────────────────────────────────┤
│  工具栏：网格视图 | 表格视图 | 缩略图大小 | 过滤器  │
├──────────┬──────────────────────────┬──────────────┤
│          │                          │              │
│  侧边栏  │     主内容区域            │  详情面板    │
│  媒体库  │  媒体库 | 仪表板 | 搜索   │  元数据信息  │
│  列表    │  最近 | 收藏 | 匹配      │  海报预览    │
│          │                          │  操作按钮    │
│          │                          │              │
├──────────┴──────────────────────────┴──────────────┤
│  状态栏：当前操作状态 | 媒体总数                    │
└────────────────────────────────────────────────────┘
```

### 菜单栏

#### 文件菜单

- **打开 (Ctrl+O)** - 打开媒体文件
- **管理媒体库 (Ctrl+L)** - 打开媒体库管理器
- **退出 (Ctrl+Q)** - 关闭应用程序

#### 编辑菜单

- **首选项** - 打开设置窗口
  - 常规设置
  - API 提供商配置
  - 海报下载设置
  - 高级选项
- **批量操作 (Ctrl+B)** - 批量编辑、重命名、删除
- **导出媒体 (Ctrl+E)** - 导出媒体库数据
- **导入媒体 (Ctrl+I)** - 导入媒体库数据

#### 查看菜单

- **切换面板 (F9)** - 显示/隐藏侧边栏和详情面板

#### 帮助菜单

- **帮助中心 (F1)** - 打开帮助文档
- **显示新手引导向导** - 重新运行设置向导
- **关于** - 查看版本信息和许可证

### 工具栏

工具栏提供快速访问常用功能：

#### 视图切换

- **网格视图** - 以缩略图网格形式显示媒体
- **表格视图** - 以列表形式显示媒体（支持排序）

#### 缩略图大小（仅网格视图）

- **小** - 紧凑显示，每行更多项目
- **中** - 默认大小（推荐）
- **大** - 更大的缩略图，显示更多细节
- **超大** - 最大化缩略图

#### 过滤器

- **全部** - 显示所有媒体类型
- **电影** - 仅显示电影
- **电视剧** - 仅显示电视剧

### 侧边栏

左侧侧边栏显示媒体库树形结构：

- **媒体库节点** - 点击展开查看媒体库
- **右键菜单**
  - 扫描媒体库
  - 编辑媒体库设置
  - 删除媒体库

### 详情面板

右侧详情面板显示所选媒体的详细信息：

#### 详情标签页

显示核心元数据：
- **标题** - 媒体标题
- **年份** - 发行年份
- **类型** - 电影或电视剧
- **评分** - TMDB 评分
- **时长** - 播放时长
- **简介** - 剧情简介

#### 海报标签页

显示海报图像：
- 自动加载 TMDB 海报
- 支持查看和下载

#### 信息标签页

显示扩展信息：
- **导演** - 导演姓名
- **编剧** - 编剧姓名
- **制片公司** - 出品方

#### 演员标签页

显示演员列表：
- 演员姓名
- 角色名称

#### 操作标签页

提供快捷操作按钮：
- **播放** - 使用默认播放器打开
- **编辑元数据** - 打开元数据编辑器
- **下载海报** - 手动下载海报

#### 文件标签页

显示文件信息：
- **文件路径** - 完整文件路径
- **文件大小** - 文件大小（GB/MB）
- **添加日期** - 添加到媒体库的日期

---

## 核心功能

### 添加和管理媒体库

媒体库是影藏·媒体管理器的核心概念，用于组织和管理不同类型的媒体文件。

#### 创建新媒体库

1. 点击菜单**文件 → 管理媒体库**（或按 `Ctrl+L`）
2. 在媒体库管理器对话框中，点击**添加媒体库**
3. 填写媒体库信息：
   - **名称**：为媒体库起一个有意义的名称（例如："动作电影"、"家庭剧集"）
   - **路径**：点击**浏览**选择媒体文件所在的文件夹
   - **类型**：选择**电影**或**电视剧**
4. 点击**保存**

#### 编辑现有媒体库

1. 在媒体库管理器中选择要编辑的媒体库
2. 点击**编辑**按钮
3. 修改名称、路径或类型
4. 点击**保存**

> **注意**：更改媒体库路径后，需要重新扫描媒体库。

#### 删除媒体库

1. 在媒体库管理器中选择要删除的媒体库
2. 点击**删除**按钮
3. 确认删除操作

> **警告**：删除媒体库将删除该媒体库的所有元数据，但不会删除实际的媒体文件。

#### 媒体库最佳实践

- **按类型分类**：为电影和电视剧创建不同的媒体库
- **按主题分类**：可以创建多个媒体库（例如："4K 电影"、"动画片"）
- **定期维护**：定期扫描媒体库以检测新文件

### 扫描本地文件夹

扫描是自动发现和识别媒体文件的过程。

#### 自动扫描

创建或编辑媒体库后，应用会自动扫描指定的文件夹。扫描过程：

1. **检测文件** - 查找支持的视频文件
2. **解析文件名** - 提取标题、年份、季集信息
3. **搜索匹配** - 在 TMDB/TVDB 中搜索匹配项
4. **队列显示** - 在**匹配**标签页显示结果

#### 手动扫描

在侧边栏的媒体库上右键点击，选择**扫描媒体库**。

#### 支持的文件格式

影藏·媒体管理器支持以下视频格式：

| 格式 | 扩展名 |
|------|--------|
| **Matroska** | .mkv |
| **MP4** | .mp4, .m4v |
| **AVI** | .avi |
| **MOV** | .mov |
| **Flash Video** | .flv, .f4v |
| **Windows Media** | .wmv |
| **WebM** | .webm |
| **MPEG** | .mpg, .mpeg |
| **Transport Stream** | .m2ts, .mts, .ts |
| **DVD** | .vob |

#### 文件名识别规则

为了获得最佳识别效果，建议按以下格式命名文件：

**电影：**
```
电影标题 (年份).ext
电影标题.年份.ext
Movie Title (2023).mkv
阿凡达 (2009).mp4
```

**电视剧：**
```
剧集名 S01E01.ext
剧集名 - S01E01 - 集标题.ext
Show Name 1x01.ext
权力的游戏 S08E06.mkv
```

应用会自动识别：
- **年份**：1900-2099 的四位数字
- **季集信息**：S01E01、1x01、s1e1 等格式
- **质量标签**：1080p、4K、BluRay、WEB-DL 等（会被过滤）

### 导入媒体文件

除了扫描本地文件夹，您还可以手动导入媒体文件。

#### 单个文件导入

1. 点击菜单**文件 → 打开**（或按 `Ctrl+O`）
2. 浏览并选择媒体文件
3. 文件将添加到当前选中的媒体库

#### 批量导入

使用导入/导出向导批量导入媒体数据：

1. 点击菜单**编辑 → 导入媒体**（或按 `Ctrl+I`）
2. 选择导入源：
   - **CSV 文件** - 从 CSV 文件导入
   - **JSON 文件** - 从 JSON 文件导入
   - **NFO 文件** - 从 Kodi/Jellyfin NFO 文件导入
3. 选择目标媒体库
4. 映射字段（如需要）
5. 点击**导入**

### 编辑媒体信息

影藏·媒体管理器提供强大的元数据编辑功能。

#### 编辑单个媒体

1. 在媒体列表中选择媒体项目
2. 使用以下任一方式打开编辑器：
   - 双击媒体项目
   - 右键点击，选择**编辑元数据**
   - 在详情面板的**操作**标签页中点击**编辑元数据**
3. 在元数据编辑器中修改信息：
   - **标题** - 媒体标题
   - **原标题** - 原始语言标题
   - **年份** - 发行年份
   - **评分** - 0-10 的评分
   - **简介** - 剧情简介
   - **导演** - 导演姓名
   - **编剧** - 编剧姓名
   - **演员** - 演员列表（点击**移除**删除演员）
   - **类型标签** - 类型分类
4. 点击**保存**应用更改

#### 元数据字段说明

| 字段 | 说明 | 示例 |
|------|------|------|
| **标题** | 媒体的主标题 | "泰坦尼克号" |
| **原标题** | 原始语言的标题 | "Titanic" |
| **年份** | 首次发行年份 | 1997 |
| **评分** | 评分（0-10） | 7.8 |
| **时长** | 播放时长（分钟） | 194 |
| **简介** | 简短的剧情介绍 | "一段在泰坦尼克号..." |
| **导演** | 导演姓名 | "詹姆斯·卡梅隆" |
| **编剧** | 编剧姓名 | "詹姆斯·卡梅隆" |
| **演员** | 演员姓名和角色 | "莱昂纳多·迪卡普里奥 饰 杰克" |
| **类型** | 类型标签 | "爱情, 剧情" |
| **制片公司** | 出品公司 | "20世纪福克斯" |
| **播出日期** | 首次播出日期 | "1997-12-19" |

### TMDB 自动匹配

TMDB（The Movie Database）是影藏·媒体管理器的主要元数据来源。

#### 配置 TMDB API

1. 获取 API 密钥（参见[首次启动](#首次启动)部分）
2. 打开**编辑 → 首选项**
3. 切换到**提供商**标签页
4. 在**TMDB API 密钥**字段中输入密钥
5. 点击**应用**

#### 自动匹配工作流

扫描后，应用会自动尝试匹配：

1. **扫描文件** - 检测视频文件
2. **解析文件名** - 提取标题和年份
3. **搜索 TMDB** - 自动搜索匹配项
4. **显示结果** - 在**匹配**标签页显示候选项
5. **用户确认** - 您可以：
   - **接受匹配** - 确认匹配结果
   - **手动搜索** - 搜索其他结果
   - **跳过** - 跳过当前项目

#### 手动搜索匹配

如果自动匹配不准确：

1. 在**匹配**标签页选择要匹配的项目
2. 点击**手动搜索**按钮
3. 在搜索框中输入正确的标题
4. 点击**搜索**
5. 从搜索结果中选择正确的项目
6. 点击**接受匹配**

#### 完成匹配

确认所有匹配后：

1. 检查匹配结果是否正确
2. 点击**完成媒体库**按钮
3. 应用将：
   - 保存元数据到数据库
   - 下载海报图像（如启用）
   - 生成 NFO 文件（如启用）
   - 更新媒体库视图

### 搜索和筛选媒体

影藏·媒体管理器提供强大的搜索和筛选功能。

#### 使用搜索标签页

1. 点击**搜索**标签页
2. 在搜索框中输入关键词
3. 应用会实时搜索以下字段：
   - 标题
   - 原标题
   - 导演
   - 演员
   - 简介
4. 点击**搜索**按钮查看结果

#### 高级筛选

搜索标签页提供高级筛选选项：

- **媒体类型** - 筛选电影或电视剧
- **年份范围** - 按发行年份筛选
- **评分范围** - 按评分筛选
- **类型标签** - 按类型筛选

使用方法：
1. 在搜索标签页点击**高级筛选**（如可用）
2. 设置筛选条件
3. 点击**应用筛选**
4. 点击**清除**重置筛选

#### 保存搜索

保存常用的搜索条件：

1. 设置搜索和筛选条件
2. 点击**保存搜索**按钮
3. 输入搜索名称（例如："高分动作片"）
4. 点击**确定**

加载已保存的搜索：
1. 点击**加载搜索**按钮
2. 从列表中选择已保存的搜索
3. 点击**加载**

#### 工具栏快速筛选

使用工具栏的筛选按钮快速筛选：
- **全部** - 显示所有媒体
- **电影** - 仅显示电影
- **电视剧** - 仅显示电视剧

### 收藏和标记

使用收藏和标签功能组织您的媒体收藏。

#### 添加到收藏

1. 在媒体列表中选择媒体项目
2. 右键点击，选择**切换收藏**
3. 或在详情面板中点击收藏按钮（星标）

#### 查看收藏

点击**收藏**标签页查看所有收藏的媒体。

#### 使用快速标签

快速为媒体添加标签：

1. 在媒体列表中选择媒体项目
2. 右键点击，选择**快速标签**
3. 选择或创建标签：
   - **已观看** - 标记为已观看
   - **想看** - 添加到观看列表
   - **自定义标签** - 创建自定义标签

#### 管理标签

在元数据编辑器中管理标签：

1. 打开元数据编辑器
2. 在**标签**部分：
   - 添加新标签
   - 删除现有标签
   - 编辑标签名称
3. 点击**保存**

---

## 高级功能

### 批量编辑

批量操作可以同时处理多个媒体项目。

#### 打开批量操作对话框

1. 在媒体列表中选择多个项目（按住 `Ctrl` 或 `Shift` 键多选）
2. 使用以下任一方式打开：
   - 点击菜单**编辑 → 批量操作**（或按 `Ctrl+B`）
   - 右键点击选中项目，选择**批量操作**

#### 批量重命名

批量重命名文件以符合命名规范：

1. 在批量操作对话框中选择**重命名**操作
2. 配置重命名模板：
   - **电影模板**：`{title} ({year})`
   - **电视剧模板**：`{show_name} - S{season:02d}E{episode:02d} - {title}`
3. 可用的占位符：
   - `{title}` - 标题
   - `{year}` - 年份
   - `{director}` - 导演
   - `{show_name}` - 剧集名称
   - `{season}` - 季数
   - `{episode}` - 集数
4. 点击**预览**查看重命名结果
5. 确认无误后点击**执行**

#### 批量编辑元数据

同时修改多个媒体的元数据：

1. 在批量操作对话框中选择**编辑元数据**
2. 选择要修改的字段：
   - 类型标签
   - 评分调整
   - 添加/删除标签
3. 设置新值
4. 点击**应用**

#### 批量下载海报

为多个媒体下载海报：

1. 在批量操作对话框中选择**下载海报**
2. 选择海报类型：
   - **主海报** - 主要海报图像
   - **背景图** - 背景横幅图像
3. 设置下载选项：
   - 图片质量（低/中/高/原始）
   - 语言偏好
4. 点击**开始下载**

#### 批量删除

批量删除媒体项目：

1. 在批量操作对话框中选择**删除**
2. 选择删除模式：
   - **仅从媒体库删除** - 保留文件，仅删除数据库记录
   - **移动到回收站** - 将文件移动到系统回收站
   - **永久删除** - 彻底删除文件（危险！）
3. 确认删除操作
4. 点击**执行**

> **警告**：批量删除操作不可撤销，请谨慎使用。

### 导入/导出数据

导入/导出功能用于备份、迁移或共享媒体库数据。

#### 导出媒体库

1. 点击菜单**编辑 → 导出媒体**（或按 `Ctrl+E`）
2. 在导入/导出向导中选择**导出**
3. 选择导出格式：
   - **JSON** - 完整的结构化数据（推荐）
   - **CSV** - 表格格式，可用 Excel 打开
   - **NFO** - Kodi/Jellyfin 兼容格式
4. 选择要导出的媒体库
5. 设置导出选项：
   - **包含海报** - 导出海报图像
   - **包含文件路径** - 导出文件路径信息
   - **仅导出收藏** - 仅导出收藏的媒体
6. 选择保存位置
7. 点击**导出**

#### 导入媒体库

1. 点击菜单**编辑 → 导入媒体**（或按 `Ctrl+I`）
2. 在导入/导出向导中选择**导入**
3. 选择导入格式：
   - **JSON** - 导入 JSON 文件
   - **CSV** - 导入 CSV 文件
   - **NFO** - 导入 NFO 文件
4. 浏览并选择要导入的文件
5. 选择目标媒体库
6. 映射字段（CSV 导入时）：
   - 将 CSV 列映射到媒体字段
   - 预览前几行数据
7. 处理冲突：
   - **跳过** - 跳过重复项
   - **覆盖** - 覆盖现有数据
   - **保留两者** - 创建新条目
8. 点击**导入**

#### 导出 NFO 文件

NFO 文件是 Kodi、Jellyfin、Emby 等媒体服务器使用的元数据格式。

1. 在媒体列表中选择媒体项目
2. 右键点击，选择**导出 NFO**（如可用）
3. 或在批量操作中选择**导出 NFO**
4. 选择 NFO 格式：
   - **Kodi** - 适用于 Kodi 媒体中心
   - **Jellyfin** - 适用于 Jellyfin 媒体服务器
5. 选择导出位置：
   - **与媒体文件同目录** - 推荐，自动识别
   - **自定义目录** - 指定其他位置
6. 点击**导出**

NFO 文件将包含：
- 标题、年份、评分
- 导演、编剧、演员
- 剧情简介
- 类型标签
- 海报和背景图路径

### 海报管理

海报是媒体视觉识别的重要部分。

#### 自动下载海报

在首选项中配置自动下载：

1. 打开**编辑 → 首选项**
2. 切换到**海报**标签页
3. 启用**自动下载海报**
4. 配置下载选项：
   - **质量**：低/中/高/原始
     - **低**：适合网络环境差的情况（约 200KB）
     - **中**：平衡质量和大小（约 500KB）
     - **高**：推荐，高清质量（约 1-2MB）
     - **原始**：最高质量，文件较大（2-5MB）
   - **语言偏好**：zh-CN（简体中文）/ en（英语）
   - **下载类型**：
     - ☑ 主海报（纵向）
     - ☑ 背景图（横向）
     - ☐ Logo 图像
5. 点击**应用**

#### 手动下载海报

为单个媒体手动下载海报：

1. 在媒体列表中选择媒体项目
2. 在详情面板的**操作**标签页中点击**下载海报**
3. 选择要下载的海报类型
4. 应用将从 TMDB 下载海报

#### 查看和管理海报

1. 在详情面板切换到**海报**标签页
2. 查看当前海报
3. 右键点击海报：
   - **另存为** - 保存海报到其他位置
   - **设置为主海报** - 设为主要显示海报
   - **删除海报** - 删除海报图像
   - **重新下载** - 重新下载海报

#### 自定义海报

使用自己的图片作为海报：

1. 准备海报图片（推荐尺寸：2000x3000 像素，纵横比 2:3）
2. 在详情面板的**海报**标签页右键点击
3. 选择**导入自定义海报**
4. 浏览并选择图片文件
5. 图片将被复制到媒体库目录

#### 海报存储位置

海报默认存储在：
- **Windows**：`%USERPROFILE%\.media-manager\posters\`
- **Linux/macOS**：`~/.media-manager/posters/`

海报文件名格式：`{tmdb_id}-poster.jpg`

### 元数据编辑

详细的元数据管理功能。

#### 元数据编辑器界面

元数据编辑器分为多个部分：

1. **基本信息**
   - 标题、原标题
   - 年份、评分
   - 类型（电影/电视剧）

2. **媒体信息**
   - 时长（分钟）
   - 播出日期
   - 文件大小

3. **剧情和演职人员**
   - 简介（支持多行文本）
   - 导演、编剧
   - 演员列表（可添加/删除）

4. **分类和标签**
   - 类型标签（动作、喜剧等）
   - 自定义标签
   - 收藏状态

5. **海报和图像**
   - 海报预览
   - 背景图预览
   - 下载/更换按钮

#### 添加演员信息

1. 在元数据编辑器中找到**演员**部分
2. 点击**添加演员**按钮
3. 输入演员信息：
   - **姓名** - 演员姓名
   - **角色** - 饰演的角色
   - **顺序** - 演员表中的排序（可选）
4. 点击**确定**添加
5. 重复以上步骤添加更多演员

删除演员：
1. 在演员列表中选择要删除的演员
2. 点击**移除**按钮

#### 编辑剧情简介

1. 在元数据编辑器中找到**简介**字段
2. 在多行文本框中输入或编辑简介
3. 支持的格式：
   - 纯文本
   - 换行符
   - 无 HTML 标签
4. 建议长度：200-500 字

#### 设置评分

1. 在元数据编辑器中找到**评分**字段
2. 输入 0-10 之间的数字（支持小数，如 7.5）
3. 评分会显示在媒体列表和详情面板中

#### 修改文件路径

1. 在元数据编辑器中找到**文件**标签页
2. 查看当前文件路径
3. 点击**浏览**选择新的文件路径
4. 应用将更新数据库中的路径

> **注意**：修改路径不会移动实际文件，仅更新数据库记录。

### 媒体库设置

媒体库的高级配置选项。

#### 媒体库属性

在媒体库管理器中编辑媒体库属性：

1. **名称** - 媒体库显示名称
2. **路径** - 媒体文件所在文件夹
3. **类型** - 电影或电视剧
4. **描述** - 媒体库描述（可选）

#### 扫描选项

配置扫描行为：

1. **自动扫描** - 启动时自动扫描
2. **监控文件夹** - 实时监控文件夹变化（实验性功能）
3. **扫描深度** - 子文件夹扫描深度
   - **1 层** - 仅扫描顶层文件夹
   - **2 层** - 扫描顶层和一级子文件夹
   - **无限** - 扫描所有子文件夹
4. **忽略文件** - 配置要忽略的文件或文件夹
   - 默认忽略：`sample`、`trailer`、`.tmp` 等

#### 命名规则

配置重命名规则：

1. **电影模板**
   - 默认：`{title} ({year})`
   - 其他选项：
     - `{title} - {year}`
     - `{title}.{year}.{quality}`
     - `{title} ({year}) [{quality}]`

2. **电视剧模板**
   - 默认：`{show_name} - S{season:02d}E{episode:02d} - {title}`
   - 其他选项：
     - `{show_name} - {season}x{episode} - {title}`
     - `{show_name} S{season:02d}E{episode:02d}`

3. **自定义占位符**
   - 可用的占位符在重命名界面中列出
   - 支持格式化（如 `{season:02d}` 表示两位数字，不足补零）

#### 后处理选项

扫描完成后的自动处理：

1. **重命名文件** - 自动重命名为规范格式
2. **生成 NFO** - 自动生成 NFO 元数据文件
3. **下载海报** - 自动下载海报和背景图
4. **创建文件夹** - 为每部电影/剧集创建独立文件夹
5. **整理文件** - 移动文件到整理后的目录结构

---

## 常见问题

### 如何添加多个媒体库？

您可以创建任意数量的媒体库：

1. 打开**文件 → 管理媒体库**
2. 为每个媒体库点击**添加媒体库**
3. 建议按类型或主题分类：
   - "动作电影" - 动作片
   - "家庭剧集" - 电视剧
   - "纪录片" - 纪录片
   - "4K 收藏" - 高清影片

### 支持哪些视频格式？

影藏·媒体管理器支持所有主流视频格式：

**首选格式**（推荐）：
- **MKV** - 最佳兼容性，支持多音轨和字幕
- **MP4** - 广泛支持，体积适中
- **AVI** - 传统格式，兼容性好

**其他支持格式**：
- MOV（QuickTime）
- FLV（Flash Video）
- WMV（Windows Media）
- WebM（Web 视频）
- MPEG/MPG（MPEG 视频）
- M2TS/MTS/TS（蓝光格式）
- VOB（DVD 格式）

**不支持的格式**：
- 图片文件（JPG、PNG、GIF）
- 音频文件（MP3、FLAC、AAC）
- 压缩包（RAR、ZIP、7Z）- 需先解压

### 如何更新元数据？

有多种方式更新元数据：

**方式一：重新匹配**
1. 在媒体列表中选择项目
2. 右键点击，选择**重新匹配**（如可用）
3. 在匹配对话框中搜索正确的匹配项
4. 点击**接受匹配**

**方式二：手动编辑**
1. 双击媒体项目打开元数据编辑器
2. 修改需要更新的字段
3. 点击**保存**

**方式三：从 TMDB 刷新**
1. 确保有有效的 TMDB API 密钥
2. 右键点击媒体项目
3. 选择**从 TMDB 刷新**（如可用）
4. 应用将重新下载最新元数据

### 如何导出和备份数据？

**导出媒体库数据**：
1. 点击**编辑 → 导出媒体**（`Ctrl+E`）
2. 选择 **JSON 格式**（推荐，保留完整数据）
3. 选择要导出的媒体库
4. 启用**包含海报**选项
5. 选择保存位置
6. 点击**导出**

**备份数据库文件**：
数据库文件位置：
- Windows：`%USERPROFILE%\.media-manager\media_manager.db`
- Linux/macOS：`~/.media-manager/media_manager.db`

直接复制此文件到安全位置即可备份。

**恢复数据**：
1. 点击**编辑 → 导入媒体**（`Ctrl+I`）
2. 选择之前导出的 JSON 文件
3. 选择目标媒体库
4. 点击**导入**

或直接替换数据库文件：
1. 关闭应用程序
2. 将备份的 `.db` 文件复制回数据目录
3. 重新启动应用

### 程序无法识别文件怎么办？

**可能的原因和解决方案**：

**1. 文件名不规范**
- **问题**：文件名缺少标题或年份信息
- **解决**：重命名文件，确保包含标题和年份
  - 正确：`泰坦尼克号 (1997).mkv`
  - 错误：`movie.mkv`、`downloaded_file.avi`

**2. 文件格式不支持**
- **问题**：文件扩展名不在支持列表中
- **解决**：转换为支持的格式（推荐 MKV 或 MP4）

**3. 文件在忽略列表中**
- **问题**：文件名包含 `sample`、`trailer` 等关键词
- **解决**：重命名文件，去除这些关键词

**4. API 密钥未配置**
- **问题**：无法连接到 TMDB 获取元数据
- **解决**：在**编辑 → 首选项 → 提供商**中配置 API 密钥

**5. 标题不在 TMDB 数据库中**
- **问题**：非常小众或新发行的影片
- **解决**：
  - 使用手动搜索，尝试不同的关键词
  - 或手动创建元数据（双击项目，手动输入信息）

**6. 文件权限问题**
- **问题**：应用无权访问文件
- **解决**：
  - Windows：右键文件夹 → 属性 → 安全，添加读取权限
  - Linux/macOS：使用 `chmod` 命令添加权限

**7. 网络连接问题**
- **问题**：无法访问 TMDB API
- **解决**：
  - 检查网络连接
  - 检查防火墙设置
  - 如在中国大陆，可能需要配置代理

### 如何修改界面语言？

影藏·媒体管理器当前仅支持简体中文，无需配置语言设置。

### 如何提高扫描速度？

**优化建议**：

1. **禁用自动下载海报**
   - 在首选项中暂时禁用自动下载
   - 扫描完成后批量下载海报

2. **减少扫描深度**
   - 在媒体库设置中限制子文件夹深度
   - 仅扫描必要的文件夹

3. **关闭实时监控**
   - 禁用文件夹监控功能
   - 手动触发扫描

4. **使用 SSD**
   - 将数据库文件存储在 SSD 上
   - 显著提升数据库操作速度

5. **增加内存**
   - 确保系统有足够的可用内存
   - 建议至少 4GB RAM

### 如何播放媒体文件？

**方式一：使用默认播放器**
1. 在媒体列表中选择媒体项目
2. 在详情面板的**操作**标签页中点击**播放**
3. 文件将使用系统默认播放器打开

**方式二：使用其他播放器**
1. 右键点击媒体项目
2. 选择**打开方式**
3. 选择播放器应用程序

**方式三：直接打开文件**
1. 在详情面板的**文件**标签页中查看文件路径
2. 点击路径打开文件所在文件夹
3. 使用您喜欢的播放器打开

**推荐播放器**：
- **VLC Media Player** - 免费，支持所有格式
- **PotPlayer** - Windows 专业播放器
- **MPC-HC** - 轻量级播放器
- **IINA** - macOS 现代播放器

### 如何删除重复项？

影藏·媒体管理器可以检测重复的媒体项：

1. 打开**工具 → 查找重复项**（如可用）
2. 应用将扫描并显示可能的重复项：
   - 相同标题和年份
   - 相同文件路径
   - 相同 TMDB ID
3. 检查重复项列表
4. 选择要保留的版本
5. 点击**删除其他版本**

或手动删除：
1. 在搜索中输入媒体标题
2. 查看搜索结果中的重复项
3. 选择不需要的项目
4. 按 `Delete` 键或右键点击删除

---

## 故障排除

### 常见错误信息及解决方案

#### 错误："数据库无法连接"

**错误信息**：`无法连接到数据库` 或 `Database connection failed`

**原因**：
- 数据库文件损坏
- 文件权限问题
- 磁盘空间不足

**解决方案**：
1. **检查磁盘空间**
   - 确保系统盘有至少 100MB 可用空间
   - 清理临时文件

2. **检查文件权限**
   - Windows：右键数据目录 → 属性 → 安全
   - Linux/macOS：`chmod 755 ~/.media-manager`

3. **重建数据库**
   - 关闭应用程序
   - 重命名现有数据库文件（作为备份）：
     - `media_manager.db` → `media_manager.db.bak`
   - 重新启动应用（将创建新数据库）
   - 从备份导入数据（使用导入功能）

#### 错误："API 请求失败"

**错误信息**：`TMDB API 请求失败` 或 `API request failed`

**原因**：
- API 密钥无效或过期
- 网络连接问题
- API 服务暂时不可用

**解决方案**：
1. **验证 API 密钥**
   - 登录 TMDB 官网验证密钥是否有效
   - 在应用中重新输入密钥

2. **检查网络连接**
   - 确保能够访问 `https://api.themoviedb.org`
   - 尝试在浏览器中打开该网址

3. **配置代理**（如在受限网络环境中）
   - 打开**编辑 → 首选项 → 网络**
   - 配置代理服务器
   - 输入代理地址和端口

4. **稍后重试**
   - TMDB 服务可能暂时维护
   - 等待几分钟后重试

#### 错误："文件无法访问"

**错误信息**：`无法访问文件` 或 `File not accessible`

**原因**：
- 文件已被移动或删除
- 文件权限不足
- 网络驱动器断开连接

**解决方案**：
1. **验证文件是否存在**
   - 在详情面板查看文件路径
   - 在文件管理器中检查文件是否存在

2. **更新文件路径**
   - 如果文件已移动，在元数据编辑器中更新路径
   - 或重新扫描媒体库

3. **检查权限**
   - 确保应用有权限读取文件
   - Windows：右键文件 → 属性 → 安全
   - Linux/macOS：`ls -l` 查看权限

4. **重新连接网络驱动器**（如文件在网络位置）
   - 检查网络连接
   - 重新映射网络驱动器

#### 错误："海报下载失败"

**错误信息**：`海报下载失败` 或 `Poster download failed`

**原因**：
- 网络连接问题
- TMDB 没有该媒体的海报
- 磁盘空间不足

**解决方案**：
1. **检查网络连接**
   - 确保网络稳定
   - 尝试在浏览器中访问 TMDB

2. **检查磁盘空间**
   - 确保海报目录所在磁盘有足够空间
   - 至少需要 50MB 可用空间

3. **手动下载海报**
   - 访问 TMDB 网站查找媒体页面
   - 右键保存海报图片
   - 在应用中选择**导入自定义海报**

4. **调整海报质量**
   - 在首选项中降低海报质量设置
   - 较小的文件更容易下载成功

### 性能优化建议

#### 应用启动缓慢

**优化方法**：

1. **减少启动时的自动加载**
   - 在首选项中禁用"启动时自动扫描"
   - 禁用"启动时加载所有媒体库"

2. **定期清理数据库**
   - 删除不需要的媒体库
   - 删除已不存在的文件记录

3. **使用 SSD**
   - 将应用和数据库安装在 SSD 上
   - 显著提升启动速度

4. **关闭不必要的启动项**
   - 减少系统后台程序
   - 释放系统资源

#### 媒体列表显示卡顿

**优化方法**：

1. **降低缩略图质量**
   - 在首选项中调整缩略图缓存大小
   - 使用较小的缩略图尺寸

2. **使用表格视图**
   - 表格视图比网格视图更轻量
   - 切换到表格视图以提升性能

3. **分批加载**
   - 不要一次加载所有媒体
   - 使用搜索和筛选功能

4. **增加内存**
   - 升级系统内存
   - 关闭其他占用内存的程序

#### 扫描速度慢

参见[常见问题 - 如何提高扫描速度](#如何提高扫描速度)。

#### 海报加载缓慢

**优化方法**：

1. **启用海报缓存**
   - 在首选项中启用"海报缓存"
   - 设置适当的缓存大小（建议 500MB）

2. **批量下载海报**
   - 不要实时下载海报
   - 使用批量下载功能一次性下载

3. **降低海报质量**
   - 选择"中"或"低"质量
   - 减少下载时间和存储空间

4. **使用本地海报**
   - 手动下载海报到本地
   - 使用"导入自定义海报"功能

### 数据恢复

#### 恢复误删除的媒体

**场景一：仅从媒体库删除（文件仍存在）**

1. 在媒体库管理器中选择媒体库
2. 点击**扫描**重新扫描文件夹
3. 应用将重新发现文件
4. 重新匹配元数据

**场景二：移动到回收站**

1. 打开系统回收站
2. 找到并恢复文件
3. 在应用中重新扫描媒体库

**场景三：永久删除（使用数据库备份）**

1. 关闭应用程序
2. 恢复备份的数据库文件：
   - 将 `media_manager.db.bak` 重命名为 `media_manager.db`
3. 重新启动应用
4. 数据将恢复到备份时的状态

> **重要提示**：定期备份数据库文件和导出媒体库数据，以防数据丢失。

#### 修复损坏的数据库

**方法一：使用内置修复工具**

1. 打开**工具 → 数据库维护**（如可用）
2. 选择**修复数据库**
3. 等待修复完成
4. 重新启动应用

**方法二：导出并重新导入**

1. 尝试导出所有媒体库数据（**编辑 → 导出媒体**）
2. 如果导出成功：
   - 关闭应用
   - 删除或重命名损坏的数据库文件
   - 重新启动应用（创建新数据库）
   - 导入之前导出的数据
3. 如果导出失败，只能使用备份文件

**方法三：使用 SQLite 工具修复**（高级用户）

```bash
# 安装 SQLite（如未安装）
# Windows: 从 sqlite.org 下载
# Linux: sudo apt install sqlite3
# macOS: brew install sqlite3

# 打开数据库
sqlite3 ~/.media-manager/media_manager.db

# 检查完整性
PRAGMA integrity_check;

# 尝试修复
PRAGMA quick_check;

# 如果发现问题，导出数据
.output backup.sql
.dump
.exit

# 创建新数据库并导入
sqlite3 new_database.db < backup.sql
```

#### 迁移到新计算机

**完整迁移步骤**：

1. **在旧计算机上**：
   - 导出所有媒体库数据（**编辑 → 导出媒体**）
   - 备份数据库文件：
     - Windows：`%USERPROFILE%\.media-manager\media_manager.db`
     - Linux/macOS：`~/.media-manager/media_manager.db`
   - 备份海报文件夹：
     - Windows：`%USERPROFILE%\.media-manager\posters\`
     - Linux/macOS：`~/.media-manager/posters/`
   - 备份设置文件：
     - Windows：`%USERPROFILE%\.media-manager\settings.json`
     - Linux/macOS：`~/.media-manager/settings.json`

2. **在新计算机上**：
   - 安装影藏·媒体管理器
   - 首次启动后关闭应用
   - 将备份的文件复制到对应位置
   - 重新启动应用

3. **更新文件路径**（如媒体文件位置改变）：
   - 打开媒体库管理器
   - 编辑每个媒体库，更新路径
   - 重新扫描媒体库

---

## 获取更多帮助

### 应用内帮助

- **帮助中心**：按 `F1` 或选择**帮助 → 帮助中心**
- **新手引导**：选择**帮助 → 显示新手引导向导**
- **快速参考**：查看 `docs/HELP_QUICK_REFERENCE.md`

### 在线资源

- **项目主页**：访问 GitHub 仓库
- **问题反馈**：在 GitHub Issues 中提交问题
- **功能建议**：在 GitHub Discussions 中讨论

### 日志文件

遇到问题时，查看日志文件以获取详细错误信息：

- **Windows**：`%USERPROFILE%\.media-manager\logs\app.log`
- **Linux/macOS**：`~/.media-manager/logs/app.log`

### 社区支持

- **讨论区**：与其他用户交流经验
- **教程**：查找用户分享的使用教程
- **FAQ**：查看常见问题解答

---

## 附录

### 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| **F1** | 打开帮助中心 |
| **F9** | 切换侧边栏和详情面板 |
| **Ctrl+O** | 打开文件 |
| **Ctrl+L** | 管理媒体库 |
| **Ctrl+B** | 批量操作 |
| **Ctrl+E** | 导出媒体 |
| **Ctrl+I** | 导入媒体 |
| **Ctrl+Q** | 退出应用 |
| **Ctrl+F** | 聚焦搜索框（在搜索标签页） |
| **Delete** | 删除选中的媒体项 |
| **Ctrl+A** | 全选（在媒体列表中） |
| **Ctrl+Click** | 多选（添加到选择） |
| **Shift+Click** | 范围选择 |

### 配置文件结构

主配置文件：`settings.json`

```json
{
  "version": "1.0.0",
  "language": "zh_CN",
  "api_keys": {
    "tmdb": "your-tmdb-api-key",
    "tvdb": "your-tvdb-api-key"
  },
  "libraries": [
    {
      "id": "lib-001",
      "name": "电影库",
      "path": "/path/to/movies",
      "type": "movie",
      "auto_scan": true
    }
  ],
  "poster_settings": {
    "auto_download": true,
    "quality": "high",
    "language": "zh-CN",
    "types": ["poster", "backdrop"]
  },
  "rename_templates": {
    "movie": "{title} ({year})",
    "tv": "{show_name} - S{season:02d}E{episode:02d} - {title}"
  },
  "ui": {
    "theme": "light",
    "thumbnail_size": "medium",
    "default_view": "grid"
  },
  "scanning": {
    "max_depth": 5,
    "ignored_patterns": ["sample", "trailer"],
    "parallel_threads": 4
  },
  "onboarding_completed": true
}
```

### 支持的占位符（重命名模板）

| 占位符 | 说明 | 示例 |
|--------|------|------|
| `{title}` | 媒体标题 | 泰坦尼克号 |
| `{original_title}` | 原始标题 | Titanic |
| `{year}` | 年份 | 1997 |
| `{director}` | 导演 | 詹姆斯·卡梅隆 |
| `{rating}` | 评分 | 7.8 |
| `{show_name}` | 剧集名称 | 权力的游戏 |
| `{season}` | 季数 | 1 |
| `{season:02d}` | 季数（两位） | 01 |
| `{episode}` | 集数 | 5 |
| `{episode:02d}` | 集数（两位） | 05 |
| `{quality}` | 质量标签 | 1080p |

### 数据库表结构

主要数据表：

- **libraries** - 媒体库信息
- **media_items** - 媒体项目
- **actors** - 演员信息
- **media_actors** - 媒体与演员关联
- **tags** - 标签
- **media_tags** - 媒体与标签关联
- **posters** - 海报信息
- **scan_history** - 扫描历史

### 系统要求详情

**最低要求**：
- CPU：双核 2.0 GHz
- 内存：4 GB RAM
- 硬盘：500 MB 可用空间（应用）+ 媒体库空间
- 操作系统：
  - Windows 10 或更高
  - macOS 10.14 或更高
  - Linux（Ubuntu 18.04 或同等版本）
- Python：3.8+ （如从源码运行）

**推荐配置**：
- CPU：四核 3.0 GHz 或更高
- 内存：8 GB RAM 或更高
- 硬盘：SSD，2 GB 可用空间
- 网络：稳定的互联网连接（用于 API 请求）

---

**感谢使用影藏·媒体管理器！**

如有任何问题或建议，欢迎通过 GitHub Issues 联系我们。祝您使用愉快！

---

*本文档最后更新：2024 年*
*版本：1.0.0*
